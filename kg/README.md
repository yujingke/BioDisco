# Knowledge Graph (KG) Setup Guide

This folder contains the necessary files and scripts to set up a Neo4j knowledge graph database for BioDisco. The knowledge graph is based on PrimeKG. The guide is specific for linux based installations.

## Neo4j Installation

### 1. Prerequisites: OpenJDK 21 Installation

Neo4j requires Java 21. Download and install OpenJDK 21:

```bash
# Download OpenJDK 21 (here we use jdk-21.0.2+13)
wget https://github.com/adoptium/temurin21-binaries/releases/download/jdk-21.0.2%2B13/OpenJDK21U-jdk_x64_linux_hotspot_21.0.2_13.tar.gz

# Extract the tarball
tar zxf OpenJDK21U-jdk_x64_linux_hotspot_21.0.2_13.tar.gz

# Create Java directory if it doesn't exist
sudo mkdir -p /opt/java

# Move Java to installation directory
sudo mv jdk-21.0.2+13 /opt/java/

# Set JAVA_HOME environment variable
export JAVA_HOME=/opt/java/jdk-21.0.2+13

# Add to your ~/.bashrc or ~/.zshrc for persistence
echo 'export JAVA_HOME=/opt/java/jdk-21.0.2+13' >> ~/.bashrc
```

### 2. Neo4j Installation

Download and install Neo4j Community Edition:

```bash
# Download Neo4j Community Edition (or the latest version)
wget https://dist.neo4j.org/neo4j-community-2025.06.2-unix.tar.gz

# Extract the tarball
tar xvf neo4j-community-2025.06.2-unix.tar.gz

# Move to installation directory
sudo mv neo4j-community-2025.06.2 /opt/

# Create symbolic link for easier access
sudo ln -s /opt/neo4j-community-2025.06.2 /opt/neo4j

# Set initial password (recommended)
/opt/neo4j-community-2025.06.2/bin/neo4j-admin dbms set-initial-password your_neo4j_password
```

## Knowledge Graph Data Setup

### 1. Download PrimeKG Data

The PrimeKG dataset is already provided in this folder as `kg.csv`. If you need to download it fresh:

```bash
# Download PrimeKG from Harvard Dataverse
wget -O kg.csv https://dataverse.harvard.edu/api/access/datafile/6180620
```

### 2. Process the Data

Use the provided scripts to prepare the data for Neo4j import:

```bash
# Split the knowledge graph into nodes and edges
python split_nodes_edges.py

# Build FAISS index for fast similarity search
python build_kg_index.py
```

### 3. Import Data into Neo4j

```bash
# Set the KG_PATH environment variable
export KG_PATH=/path/where/kg/files/exist

# Import nodes and edges into Neo4j database
/opt/neo4j-community-2025.06.2/bin/neo4j-admin database import full \
    --nodes nodes.csv \
    --relationships edges.csv \
    --overwrite-destination

# Start Neo4j service
/opt/neo4j/bin/neo4j start
```

## File Descriptions

### Data Files
- **`kg.csv`** - Original PrimeKG dataset containing biomedical entities and relationships
- **`nodes.csv`** - Processed node data for Neo4j import (generated by `split_nodes_edges.py`)
- **`edges.csv`** - Processed edge data for Neo4j import (generated by `split_nodes_edges.py`)

### Index Files (Generated)
- **`node_index.faiss`** - FAISS index for fast similarity search of nodes
- **`node_names.pkl`** - Pickled list of node names corresponding to the FAISS index
- **`node_embs.npy`** - NumPy array of node embeddings

### Scripts
- **`split_nodes_edges.py`** - Processes the raw KG data into separate nodes and edges CSV files for Neo4j import
- **`build_kg_index.py`** - Creates FAISS index and embeddings for efficient similarity search using BioSimCSE-BioLinkBERT-BASE model
